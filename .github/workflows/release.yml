name: Release Build（发布构建）

permissions:
  contents: write

on:
  release:
    types: [created]  # 当创建新的 Release 时触发
  workflow_dispatch: {}  # 支持手动触发

jobs:
  build-windows:
    name: Build Windows MSI（构建 Windows 安装包）
    runs-on: windows-latest

    steps:
      - name: Checkout（检出代码）
        uses: actions/checkout@v4

      - name: Setup Java 17 (Temurin)（配置 Java 17 环境）
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'

      - name: Install WiX (for jpackage)（安装 WiX 工具集，用于创建 MSI）
        shell: pwsh
        run: |
          choco install wixtoolset -y
          if (Get-Command refreshenv -ErrorAction SilentlyContinue) { 
            refreshenv 
          } else {
            $refreshScript = "$env:ChocolateyInstall\lib\refreshenv\tools\RefreshEnv.ps1"
            if (Test-Path $refreshScript) { & $refreshScript }
          }

      - name: Get version from pom.xml（从 pom.xml 提取版本号）
        id: get_version
        shell: pwsh
        run: |
          [xml]$pom = Get-Content 'pom.xml'
          $version = $pom.project.version
          Write-Host "Version: $version"
          "version=$version" | Out-File -Encoding utf8 -FilePath $env:GITHUB_OUTPUT -Append

      - name: Build with Maven（使用 Maven 构建项目）
        shell: pwsh
        run: |
          mvn -B clean package -DskipTests

      - name: Create runtime with jlink（使用 jlink 创建精简的 JRE）
        shell: pwsh
        run: |
          $runtimeDir = "target\runtime"
          if (Test-Path $runtimeDir) { Remove-Item -Recurse -Force $runtimeDir }
          
          # 创建包含必要模块的精简运行时环境
          jlink `
            --add-modules java.base,java.desktop,java.logging,jdk.unsupported,java.naming,java.net.http,java.prefs,java.sql,java.security.sasl,java.security.jgss,jdk.crypto.ec,java.management,java.management.rmi,jdk.crypto.cryptoki `
            --strip-debug `
            --no-header-files `
            --no-man-pages `
            --compress=2 `
            --output $runtimeDir

      - name: Prepare dist-input（准备打包输入目录）
        shell: pwsh
        run: |
          $version = "${{ steps.get_version.outputs.version }}"
          $jarName = "easy-postman-$version.jar"
          
          $distInputDir = "target\dist-input"
          if (Test-Path $distInputDir) { Remove-Item -Recurse -Force $distInputDir }
          New-Item -ItemType Directory -Path $distInputDir | Out-Null
          
          Copy-Item "target\$jarName" -Destination $distInputDir

      - name: Create MSI with jpackage（使用 jpackage 创建 MSI 安装包）
        shell: pwsh
        run: |
          $version = "${{ steps.get_version.outputs.version }}"
          $jarName = "easy-postman-$version.jar"
          $outDir = "dist"
          
          if (-not (Test-Path $outDir)) { New-Item -ItemType Directory -Path $outDir | Out-Null }
          
          # 创建 Windows MSI 安装包
          jpackage `
            --type msi `
            --input target\dist-input `
            --main-jar $jarName `
            --main-class com.laker.postman.App `
            --runtime-image target\runtime `
            --dest $outDir `
            --icon assets\win\EasyPostman.ico `
            --name EasyPostman `
            --app-version $version `
            --vendor "Laker" `
            --copyright "© 2025 Laker" `
            --win-shortcut `
            --win-menu `
            --description "A modern API testing tool similar to Postman" `
            --win-upgrade-uuid "28607609-97b7-4212-9285-04ef64a4946c" `
            --win-dir-chooser `
            --win-per-user-install `
            --win-menu-group "EasyTools" `
            --win-help-url "https://gitee.com/lakernote/easy-postman" `
            --java-options "-Xms256m" `
            --java-options "-Xmx512m" `
            --java-options "-Dfile.encoding=UTF-8" `
            --java-options "-Djavax.accessibility.assistive_technologies="

      - name: Upload to Release（上传到 GitHub Release）
        if: github.event_name == 'release'  # 只在 Release 触发时上传
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*.msi
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifact（手动触发时上传为构建产物）
        if: github.event_name == 'workflow_dispatch'  # 只在手动触发时上传为 Artifact
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Windows-MSI
          path: dist/*.msi
          retention-days: 7  # 保留 7 天

      - name: Upload MSI for Gitee sync（上传 MSI 供 Gitee 同步使用）
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-msi
          path: dist/*.msi
          retention-days: 1


  build-windows-portable:
    name: Build Windows Portable（构建 Windows 绿色版）
    runs-on: windows-latest

    steps:
      - name: Checkout（检出代码）
        uses: actions/checkout@v4

      - name: Setup Java 17 (Temurin)（配置 Java 17 环境）
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'

      - name: Get version from pom.xml（从 pom.xml 提取版本号）
        id: get_version
        shell: pwsh
        run: |
          [xml]$pom = Get-Content 'pom.xml'
          $version = $pom.project.version
          Write-Host "Version: $version"
          "version=$version" | Out-File -Encoding utf8 -FilePath $env:GITHUB_OUTPUT -Append

      - name: Build with Maven（使用 Maven 构建项目）
        shell: pwsh
        run: |
          mvn -B clean package -DskipTests

      - name: Create runtime with jlink（使用 jlink 创建精简的 JRE）
        shell: pwsh
        run: |
          $runtimeDir = "target\runtime"
          if (Test-Path $runtimeDir) { Remove-Item -Recurse -Force $runtimeDir }
          
          jlink `
            --add-modules java.base,java.desktop,java.logging,jdk.unsupported,java.naming,java.net.http,java.prefs,java.sql,java.security.sasl,java.security.jgss,jdk.crypto.ec,java.management,java.management.rmi,jdk.crypto.cryptoki `
            --strip-debug `
            --no-header-files `
            --no-man-pages `
            --compress=2 `
            --output $runtimeDir

      - name: Prepare dist-input（准备打包输入目录）
        shell: pwsh
        run: |
          $version = "${{ steps.get_version.outputs.version }}"
          $jarName = "easy-postman-$version.jar"
          
          $distInputDir = "target\dist-input"
          if (Test-Path $distInputDir) { Remove-Item -Recurse -Force $distInputDir }
          New-Item -ItemType Directory -Path $distInputDir | Out-Null
          
          Copy-Item "target\$jarName" -Destination $distInputDir

      - name: Create app-image with jpackage（创建应用镜像，免安装）
        shell: pwsh
        run: |
          $version = "${{ steps.get_version.outputs.version }}"
          $jarName = "easy-postman-$version.jar"
          $appImageDir = "target\app-image"
          
          if (Test-Path $appImageDir) { Remove-Item -Recurse -Force $appImageDir }
          
          # 创建应用镜像（app-image 类型，不是安装包）
          jpackage `
            --type app-image `
            --input target\dist-input `
            --main-jar $jarName `
            --main-class com.laker.postman.App `
            --runtime-image target\runtime `
            --dest target `
            --icon assets\win\EasyPostman.ico `
            --name EasyPostman `
            --app-version $version `
            --vendor "Laker" `
            --copyright "© 2025 Laker" `
            --java-options "-Xms256m" `
            --java-options "-Xmx512m" `
            --java-options "-Dfile.encoding=UTF-8" `
            --java-options "-Djavax.accessibility.assistive_technologies="

      - name: Package portable version（打包绿色版为 ZIP）
        shell: pwsh
        run: |
          $version = "${{ steps.get_version.outputs.version }}"
          $appImageDir = "target\EasyPostman"
          $zipName = "EasyPostman-$version-windows-portable.zip"
          
          if (-not (Test-Path "dist")) { New-Item -ItemType Directory -Path "dist" | Out-Null }
          
          # 压缩为 ZIP
          Compress-Archive -Path $appImageDir -DestinationPath "dist\$zipName" -Force
          
          Write-Host "Created portable version: $zipName"

      - name: Upload to Release（上传到 GitHub Release）
        if: github.event_name == 'release'
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*-portable.zip
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifact（手动触发时上传为构建产物）
        if: github.event_name == 'workflow_dispatch'
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Windows-Portable
          path: dist/*-portable.zip
          retention-days: 7

      - name: Upload Portable ZIP for Gitee sync（上传便携版 ZIP 供 Gitee 同步使用）
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-portable-zip
          path: dist/*-portable.zip
          retention-days: 1

  build-macos-intel:
    name: Build macOS Intel DMG（构建 macOS Intel 版安装包）
    runs-on: macos-13  # Intel x86_64

    steps:
      - name: Checkout（检出代码）
        uses: actions/checkout@v4

      - name: Setup Java 17 (Temurin)（配置 Java 17 环境）
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'

      - name: Get version from pom.xml（从 pom.xml 提取版本号）
        id: get_version
        run: |
          VERSION=$(grep -m 1 '<version>' pom.xml | sed 's/.*<version>\(.*\)<\/version>.*/\1/')
          echo "Version: $VERSION"
          echo "version=$VERSION" >> $GITHUB_OUTPUT

      - name: Build with Maven（使用 Maven 构建项目）
        run: |
          mvn -B clean package -DskipTests

      - name: Create runtime with jlink（使用 jlink 创建精简的 JRE）
        run: |
          rm -rf target/runtime
          # 创建包含必要模块的精简运行时环境
          jlink \
            --add-modules java.base,java.desktop,java.logging,jdk.unsupported,java.naming,java.net.http,java.prefs,java.sql,java.security.sasl,java.security.jgss,jdk.crypto.ec,java.management,java.management.rmi,jdk.crypto.cryptoki \
            --strip-debug \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --output target/runtime

      - name: Prepare dist-input（准备打包输入目录）
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          JAR_NAME="easy-postman-$VERSION.jar"
          
          rm -rf target/dist-input
          mkdir -p target/dist-input
          cp target/$JAR_NAME target/dist-input/

      - name: Create DMG with jpackage（使用 jpackage 创建 DMG 镜像）
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          JAR_NAME="easy-postman-$VERSION.jar"
          
          mkdir -p dist
          
          # 创建 macOS Intel DMG
          jpackage \
            --input target/dist-input \
            --main-jar $JAR_NAME \
            --main-class com.laker.postman.App \
            --runtime-image target/runtime \
            --type dmg \
            --name "EasyPostman" \
            --app-version "$VERSION" \
            --dest dist \
            --icon assets/mac/EasyPostman.icns \
            --vendor "Laker" \
            --copyright "© 2025 Laker" \
            --java-options "-Xms256m" \
            --java-options "-Xmx512m" \
            --java-options "-Dfile.encoding=UTF-8"
          
          # 重命名为 Intel 版本
          mv dist/EasyPostman-$VERSION.dmg dist/EasyPostman-$VERSION-intel.dmg

      - name: Upload to Release（上传到 GitHub Release）
        if: github.event_name == 'release'  # 只在 Release 触发时上传
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*-intel.dmg
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifact（手动触发时上传为构建产物）
        if: github.event_name == 'workflow_dispatch'  # 只在手动触发时上传为 Artifact
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-macOS-Intel-DMG
          path: dist/*-intel.dmg
          retention-days: 7  # 保留 7 天

      - name: Upload DMG for Gitee sync（上传 DMG 供 Gitee 同步使用）
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-dmg-intel
          path: dist/*-intel.dmg
          retention-days: 1

  build-macos-arm:
    name: Build macOS Apple Silicon DMG（构建 macOS Apple Silicon 版安装包）
    runs-on: macos-latest  # Apple Silicon (M1/M2/M3/M4)

    steps:
      - name: Checkout（检出代码）
        uses: actions/checkout@v4

      - name: Setup Java 17 (Temurin)（配置 Java 17 环境）
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'

      - name: Get version from pom.xml（从 pom.xml 提取版本号）
        id: get_version
        run: |
          VERSION=$(grep -m 1 '<version>' pom.xml | sed 's/.*<version>\(.*\)<\/version>.*/\1/')
          echo "Version: $VERSION"
          echo "version=$VERSION" >> $GITHUB_OUTPUT

      - name: Build with Maven（使用 Maven 构建项目）
        run: |
          mvn -B clean package -DskipTests

      - name: Create runtime with jlink（使用 jlink 创建精简的 JRE）
        run: |
          rm -rf target/runtime
          # 创建包含必要模块的精简运行时环境
          jlink \
            --add-modules java.base,java.desktop,java.logging,jdk.unsupported,java.naming,java.net.http,java.prefs,java.sql,java.security.sasl,java.security.jgss,jdk.crypto.ec,java.management,java.management.rmi,jdk.crypto.cryptoki \
            --strip-debug \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --output target/runtime

      - name: Prepare dist-input（准备打包输入目录）
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          JAR_NAME="easy-postman-$VERSION.jar"
          
          rm -rf target/dist-input
          mkdir -p target/dist-input
          cp target/$JAR_NAME target/dist-input/

      - name: Create DMG with jpackage（使用 jpackage 创建 DMG 镜像）
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          JAR_NAME="easy-postman-$VERSION.jar"
          
          mkdir -p dist
          
          # 创建 macOS Apple Silicon DMG
          jpackage \
            --input target/dist-input \
            --main-jar $JAR_NAME \
            --main-class com.laker.postman.App \
            --runtime-image target/runtime \
            --type dmg \
            --name "EasyPostman" \
            --app-version "$VERSION" \
            --dest dist \
            --icon assets/mac/EasyPostman.icns \
            --vendor "Laker" \
            --copyright "© 2025 Laker" \
            --java-options "-Xms256m" \
            --java-options "-Xmx512m" \
            --java-options "-Dfile.encoding=UTF-8"
          
          # 重命名为 ARM 版本
          mv dist/EasyPostman-$VERSION.dmg dist/EasyPostman-$VERSION-arm64.dmg

      - name: Upload to Release（上传到 GitHub Release）
        if: github.event_name == 'release'  # 只在 Release 触发时上传
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*-arm64.dmg
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifact（手动触发时上传为构建产物）
        if: github.event_name == 'workflow_dispatch'  # 只在手动触发时上传为 Artifact
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-macOS-ARM-DMG
          path: dist/*-arm64.dmg
          retention-days: 7  # 保留 7 天

      - name: Upload DMG for Gitee sync（上传 DMG 供 Gitee 同步使用）
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-dmg-arm64
          path: dist/*-arm64.dmg
          retention-days: 1

  build-jar:
    name: Build Standalone JAR（构建独立 JAR 包）
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout（检出代码）
        uses: actions/checkout@v4

      - name: Setup Java 17 (Temurin)（配置 Java 17 环境）
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'

      - name: Get version from pom.xml（从 pom.xml 提取版本号）
        id: get_version
        run: |
          VERSION=$(grep -m 1 '<version>' pom.xml | sed 's/.*<version>\(.*\)<\/version>.*/\1/')
          echo "Version: $VERSION"
          echo "version=$VERSION" >> $GITHUB_OUTPUT

      - name: Build with Maven（使用 Maven 构建项目）
        run: |
          mvn -B clean package -DskipTests

      - name: Prepare standalone JAR（准备独立 JAR 包）
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          mkdir -p dist
          cp target/easy-postman-$VERSION.jar dist/

      - name: Upload to Release（上传到 GitHub Release）
        if: github.event_name == 'release'
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*.jar
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifact（手动触发时上传为构建产物）
        if: github.event_name == 'workflow_dispatch'
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Standalone-JAR
          path: dist/*.jar
          retention-days: 7


  build-ubuntu:
    name: Build Ubuntu DEB（构建 Ubuntu 安装包）
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout（检出代码）
        uses: actions/checkout@v4

      - name: Setup Java 17 (Temurin)（配置 Java 17 环境）
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'

      - name: Install dependencies（安装系统依赖）
        run: |
          sudo apt-get update
          # 安装 GTK3、WebKit 和打包工具
          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.0-dev binutils

      - name: Get version from pom.xml（从 pom.xml 提取版本号）
        id: get_version
        run: |
          VERSION=$(grep -m 1 '<version>' pom.xml | sed 's/.*<version>\(.*\)<\/version>.*/\1/')
          echo "Version: $VERSION"
          echo "version=$VERSION" >> $GITHUB_OUTPUT

      - name: Build with Maven（使用 Maven 构建项目）
        run: |
          mvn -B clean package -DskipTests

      - name: Create runtime with jlink（使用 jlink 创建精简的 JRE）
        run: |
          rm -rf target/runtime
          # 创建包含必要模块的精简运行时环境
          jlink \
            --add-modules java.base,java.desktop,java.logging,jdk.unsupported,java.naming,java.net.http,java.prefs,java.sql,java.security.sasl,java.security.jgss,jdk.crypto.ec,java.management,java.management.rmi,jdk.crypto.cryptoki \
            --strip-debug \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --output target/runtime

      - name: Prepare dist-input（准备打包输入目录）
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          JAR_NAME="easy-postman-$VERSION.jar"
          
          rm -rf target/dist-input
          mkdir -p target/dist-input
          cp target/$JAR_NAME target/dist-input/

      - name: Create DEB with jpackage（使用 jpackage 创建 DEB 安装包）
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          JAR_NAME="easy-postman-$VERSION.jar"
          
          mkdir -p dist
          
          # 创建 Ubuntu/Debian DEB 安装包
          jpackage \
            --input target/dist-input \
            --main-jar $JAR_NAME \
            --main-class com.laker.postman.App \
            --runtime-image target/runtime \
            --type deb \
            --name "EasyPostman" \
            --app-version "$VERSION" \
            --dest dist \
            --vendor "Laker" \
            --copyright "© 2025 Laker" \
            --description "A modern API testing tool similar to Postman" \
            --linux-shortcut \
            --linux-menu-group "Development" \
            --linux-app-category "Development" \
            --java-options "-Xms256m" \
            --java-options "-Xmx512m" \
            --java-options "-Dfile.encoding=UTF-8"

      - name: Upload to Release（上传到 GitHub Release）
        if: github.event_name == 'release'  # 只在 Release 触发时上传
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*.deb
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifact（手动触发时上传为构建产物）
        if: github.event_name == 'workflow_dispatch'  # 只在手动触发时上传为 Artifact
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Ubuntu-DEB
          path: dist/*.deb
          retention-days: 7  # 保留 7 天

      - name: Upload DEB for Gitee sync（上传 DEB 供 Gitee 同步使用）
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-deb
          path: dist/*.deb
          retention-days: 1

  sync-to-gitee:
    name: Sync to Gitee Release（同步到 Gitee Release）
    if: github.event_name == 'release'
    needs: [build-windows, build-windows-portable, build-macos-intel, build-macos-arm, build-ubuntu]  # 等待所有构建完成
    runs-on: ubuntu-latest

    steps:
      - name: Download all release artifacts（下载所有发布产物）
        uses: actions/download-artifact@v4
        with:
          path: artifacts

      - name: Get version from tag（从标签获取版本号）
        id: get_version
        run: |
          TAG_NAME="${{ github.event.release.tag_name }}"
          VERSION="${TAG_NAME#v}"  # 移除 v 前缀
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "tag=$TAG_NAME" >> $GITHUB_OUTPUT

      - name: Create Gitee Release（创建 Gitee Release）
        id: gitee_release
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          TAG_NAME="${{ steps.get_version.outputs.tag }}"
          RELEASE_BODY="${{ github.event.release.body }}"
          
          if [ -z "$RELEASE_BODY" ]; then
            RELEASE_BODY="EasyPostman ${VERSION} 发布版本，支持 Windows、macOS 和 Linux。详情：https://github.com/lakernote/easy-postman"
          fi
          
          echo "Creating Gitee Release for tag: $TAG_NAME"
          
          curl -s -X POST \
            -F "access_token=${{ secrets.GITEE_TOKEN }}" \
            -F "tag_name=$TAG_NAME" \
            -F "name=$TAG_NAME" \
            -F "body=$RELEASE_BODY" \
            -F "prerelease=false" \
            -F "target_commitish=master" \
            "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases" > /tmp/release.json
          
          echo "API Response:"
          cat /tmp/release.json
          
          # 优先使用 jq（GitHub Actions Ubuntu runner 预装）
          RELEASE_ID=$(jq -r '.id // empty' /tmp/release.json 2>/dev/null || echo "")
          
          if [ -z "$RELEASE_ID" ]; then
            echo "jq extraction failed, trying python3..."
            RELEASE_ID=$(python3 -c "import sys, json; print(json.load(open('/tmp/release.json'))['id'])" 2>/dev/null || echo "")
          fi
          
          if [ -z "$RELEASE_ID" ]; then
            echo "python3 failed, trying grep..."
            RELEASE_ID=$(grep -o '"id":[0-9]*' /tmp/release.json | head -1 | grep -o '[0-9]*')
          fi
          
          if [ -z "$RELEASE_ID" ]; then
            echo "Error: Failed to create release or extract release ID"
            exit 1
          fi
          
          echo "release_id=$RELEASE_ID" >> $GITHUB_OUTPUT
          echo "Gitee Release created successfully with ID: $RELEASE_ID"

      - name: Upload MSI to Gitee（上传 MSI 到 Gitee）
        run: |
          RELEASE_ID="${{ steps.gitee_release.outputs.release_id }}"
          MSI_FILE=$(find artifacts/release-msi -name "*.msi" | head -n 1)
          
          if [ -z "$MSI_FILE" ]; then
            echo "⚠️ MSI file not found, skipping..."
            exit 0
          fi
          
          echo "📦 Uploading $(basename $MSI_FILE) to Gitee..."
          
          curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
            -F "access_token=${{ secrets.GITEE_TOKEN }}" \
            -F "file=@$MSI_FILE"
          
          echo "✅ MSI uploaded successfully!"

      - name: Upload Windows Portable ZIP to Gitee（上传 Windows 便携版 ZIP 到 Gitee）
        run: |
          RELEASE_ID="${{ steps.gitee_release.outputs.release_id }}"
          ZIP_FILE=$(find artifacts/release-portable-zip -name "*-portable.zip" | head -n 1)
          
          if [ -z "$ZIP_FILE" ]; then
            echo "⚠️ Portable ZIP file not found, skipping..."
            exit 0
          fi
          
          echo "📦 Uploading $(basename $ZIP_FILE) to Gitee..."
          
          curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
            -F "access_token=${{ secrets.GITEE_TOKEN }}" \
            -F "file=@$ZIP_FILE"
          
          echo "✅ Windows Portable ZIP uploaded successfully!"

      - name: Upload Intel DMG to Gitee（上传 Intel DMG 到 Gitee）
        run: |
          RELEASE_ID="${{ steps.gitee_release.outputs.release_id }}"
          DMG_FILE=$(find artifacts/release-dmg-intel -name "*-intel.dmg" | head -n 1)
          
          if [ -z "$DMG_FILE" ]; then
            echo "⚠️ Intel DMG file not found, skipping..."
            exit 0
          fi
          
          echo "📦 Uploading $(basename $DMG_FILE) to Gitee..."
          
          curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
            -F "access_token=${{ secrets.GITEE_TOKEN }}" \
            -F "file=@$DMG_FILE"
          
          echo "✅ Intel DMG uploaded successfully!"

      - name: Upload ARM DMG to Gitee（上传 ARM DMG 到 Gitee）
        run: |
          RELEASE_ID="${{ steps.gitee_release.outputs.release_id }}"
          DMG_FILE=$(find artifacts/release-dmg-arm64 -name "*-arm64.dmg" | head -n 1)
          
          if [ -z "$DMG_FILE" ]; then
            echo "⚠️ ARM DMG file not found, skipping..."
            exit 0
          fi
          
          echo "📦 Uploading $(basename $DMG_FILE) to Gitee..."
          
          curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
            -F "access_token=${{ secrets.GITEE_TOKEN }}" \
            -F "file=@$DMG_FILE"
          
          echo "✅ ARM DMG uploaded successfully!"

      - name: Upload DEB to Gitee（上传 DEB 到 Gitee）
        run: |
          RELEASE_ID="${{ steps.gitee_release.outputs.release_id }}"
          DEB_FILE=$(find artifacts/release-deb -name "*.deb" | head -n 1)
          
          if [ -z "$DEB_FILE" ]; then
            echo "⚠️ DEB file not found, skipping..."
            exit 0
          fi
          
          echo "📦 Uploading $(basename $DEB_FILE) to Gitee..."
          
          curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
            -F "access_token=${{ secrets.GITEE_TOKEN }}" \
            -F "file=@$DEB_FILE"
          
          echo "✅ DEB uploaded successfully!"

      - name: Summary（汇总）
        run: |
          echo "🎉 All packages have been synced to Gitee Release!"
          echo "📍 Release URL: https://gitee.com/lakernote/easy-postman/releases/${{ steps.get_version.outputs.tag }}"

